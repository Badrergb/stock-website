<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>பங்கு மேலாண்மை</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    h2, h3 { color: #333; }
    button, select, input { margin: 5px; padding: 10px; }
    table { margin-top: 20px; border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    #mainSection, #viewSection, #updateSection, #historySection { display: none; }
  </style>
</head>
<body>
  <h2>பங்கு மேலாண்மை முறைமை</h2>

  <div id="loginSection">
    <h3>பயனர் நுழைவு</h3>
    <input type="text" id="username" placeholder="பயனர் பெயர்"><br>
    <input type="password" id="password" placeholder="கடவுச்சொல்"><br>
    <button onclick="login()">நுழை</button>
  </div>

  <div id="mainSection">
    <p>வணக்கம், <strong id="user-name"></strong></p>
    <button onclick="showViewStock()">பங்கு பார்வை</button>
    <button onclick="showUpdateStock()">பங்கு புதுப்பிப்பு</button>
    <button onclick="showHistory()">பதிவு வரலாறு</button>

    <div id="viewSection">
      <h3>பங்குத் தகவல்</h3>
      <table id="stockTable"></table>
    </div>

    <div id="updateSection">
      <h3>பங்கு புதுப்பிப்பு</h3>
      <label>வ .எண்:</label><input type="text" id="count"><br>
      <label>தரம்:</label><input type="text" id="design"><br>
      <label>கெஜம்:</label>
      <select id="yard">
        <option>6 கெஜம்</option><option>7 கெஜம்</option>
        <option>8 கெஜம்</option><option>9 கெஜம்</option>
        <option>10 கெஜம்</option>
      </select><br>
      <label>அளவு:</label><input type="number" id="quantity"><br>
      <button onclick="updateStock('purchase')">வாங்கு</button>
      <button onclick="updateStock('sell')">விற்க</button>
    </div>

    <div id="historySection">
      <h3>பங்கு மாற்ற வரலாறு</h3>
      <table id="historyTable"></table>
    </div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycby3j570uLHPOqLTf1UOG2r9QrNYEOZrek2jClaZ6BRjmQGT41GLxEzda7qeikK1zEk1/exec';
    let currentUser = "";

    function login() {
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if (u && p) {
        currentUser = u;
        document.getElementById("user-name").innerText = u;
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("mainSection").style.display = "block";
      } else {
        alert("தவறான நுழைவு விவரங்கள்!");
      }
    }

    function showViewStock() {
      document.getElementById("viewSection").style.display = "block";
      document.getElementById("updateSection").style.display = "none";
      document.getElementById("historySection").style.display = "none";
      fetch(scriptURL)
        .then(res => res.json())
        .then(data => {
          let table = '<tr>';
          for (let key in data[0]) table += `<th>${key}</th>`;
          table += '</tr>';
          data.forEach(row => {
            table += '<tr>';
            for (let key in row) table += `<td>${row[key]}</td>`;
            table += '</tr>';
          });
          document.getElementById("stockTable").innerHTML = table;
        });
    }

    function showUpdateStock() {
      document.getElementById("viewSection").style.display = "none";
      document.getElementById("updateSection").style.display = "block";
      document.getElementById("historySection").style.display = "none";
    }

    function showHistory() {
      document.getElementById("viewSection").style.display = "none";
      document.getElementById("updateSection").style.display = "none";
      document.getElementById("historySection").style.display = "block";
      fetch(scriptURL + "?sheet=history")
        .then(res => res.json())
        .then(data => {
          let table = '<tr>';
          for (let key in data[0]) table += `<th>${key}</th>`;
          table += '</tr>';
          data.forEach(row => {
            table += '<tr>';
            for (let key in row) table += `<td>${row[key]}</td>`;
            table += '</tr>';
          });
          document.getElementById("historyTable").innerHTML = table;
        });
    }

    function updateStock(actionType) {
      const payload = {
        count: document.getElementById("count").value,
        design: document.getElementById("design").value,
        yard: document.getElementById("yard").value,
        quantity: parseInt(document.getElementById("quantity").value),
        action: actionType,
        username: currentUser
      };
      fetch(scriptURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(res => res.text())
      .then(msg => alert(msg));
    }
  </script>
</body>
</html>
